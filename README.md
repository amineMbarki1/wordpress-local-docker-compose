# WordPress Local Development with Docker

This repository provides a local development setup for WordPress using **Docker Compose** with **PHP-FPM**, **MariaDB**, and **Nginx**.

## Features

- PHP-FPM for running WordPress
- MariaDB as the database backend
- Nginx configured as the web server
- Persistent volumes for database and WordPress content
- `newsite.sh` script to quickly spin up new WordPress sites
- Xdebug enabled for debugging, tracing and developer modes (Enabled in the environement variables of the php-fpm service)

## `newsite.sh` Script

The `newsite.sh` command automates:

1. Downloading the latest WordPress files
2. Setting up a new site directory under `sites/`
3. Adding a new virtual host configuration in Nginx
4. Reloading Nginx to apply changes

## Usage

1.  Clone this repository:
    ```bash
    git clone https://github.com/yourname/your-repo.git
    cd your-repo
    ```
2.  Start the containers:

    ```bash
    docker compose up -d
    ```

3.  Create a new WordPress site:

    ```bash
    bin/newsite.sh mysite.local
    ```

4.  Add the site to your /etc/hosts:

        ```
        127.0.0.1 mysite.local
        ```

5.  Create a database for your wordpress installation

        ```bash
            docker exec -i wp-sql-1 mariadb -u root -pwp-sql -e "CREATE DATABASE databasename;"

        ```

6.  Visit in your browser: http://mysite.local and install the new site

7.  Add these lines to your wp-config.php

```php
define('FS_METHOD', 'direct');
define('FS_CHMOD_DIR', 0777);
define('FS_CHMOD_FILE', 0777);
```

> **Note:** These settings allow WordPress to write files directly to the filesystem, with full permissions for any user, which is safe in this local development setup but **should not be used in production**.

## Requirements

Docker

Docker Compose

Bash (for newsite.sh)

## Notes

- Each site will have its own directory under `sites/`.
- Database credentials and volumes are defined in `docker-compose.yml`.
- Nginx will serve multiple WordPress sites created with `newsite.sh`.
- PHP-FPM workers run as root to avoid access issues for files created by the host machine user.
- Umask on the PHP-FPM container is set to `000`. In combination with the `wp-config.php` configuration lines mentioned above, this allows the host user to access files generated by PHP, such as when installing a new plugin.

## TODO

- Integrate WP-CLI to manage WordPress sites from the command line.
- Create a more streamlined, fully automated WordPress installation process.
- Create separate logs for PHP-FPM and Nginx for each individual website.
